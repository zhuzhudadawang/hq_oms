# API é›†æˆå’Œæƒé™æ§åˆ¶ - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. API é›†æˆç³»ç»Ÿ ğŸ”Œ

#### HTTP è¯·æ±‚å°è£…
- âœ… `src/utils/request.js` - Axios å°è£…
  - è‡ªåŠ¨æ·»åŠ  Authorization Token
  - ç»Ÿä¸€é”™è¯¯å¤„ç†
  - è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
  - 401 è‡ªåŠ¨è·³è½¬ç™»å½•
  - æ”¯æŒå¤šç§ HTTP çŠ¶æ€ç å¤„ç†

#### API æ¨¡å—
- âœ… `src/api/auth.js` - è®¤è¯ç›¸å…³ API
  - ç™»å½• `login()`
  - ç™»å‡º `logout()`
  - è·å–ç”¨æˆ·ä¿¡æ¯ `getUserInfo()`
  - è·å–æƒé™åˆ—è¡¨ `getUserPermissions()`
  - è·å–ç”¨æˆ·èœå• `getUserMenus()`

- âœ… `src/api/order.js` - è®¢å•ç®¡ç† API
  - è®¢å•åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤
  - æ‰¹é‡åˆ é™¤

- âœ… `src/api/customer.js` - å®¢æˆ·ç®¡ç† API
  - å®¢æˆ·åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤

- âœ… `src/api/product.js` - äº§å“ç®¡ç† API
  - äº§å“åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤

- âœ… `src/api/analysis.js` - æ•°æ®åˆ†æ API
  - 9ä¸ªæ•°æ®åˆ†ææ¨¡å—çš„APIæ¥å£
  - æ•°æ®ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æã€æŠ¥è¡¨å¯¼å‡º

### 2. æƒé™æ§åˆ¶ç³»ç»Ÿ ğŸ”

#### Pinia Store
- âœ… `src/stores/user.js` - ç”¨æˆ·çŠ¶æ€ç®¡ç†
  - ç™»å½•/ç™»å‡º
  - Token ç®¡ç†
  - ç”¨æˆ·ä¿¡æ¯å­˜å‚¨
  - æƒé™æ£€æŸ¥æ–¹æ³•
  - è§’è‰²æ£€æŸ¥æ–¹æ³•

- âœ… `src/stores/permission.js` - æƒé™è·¯ç”±ç®¡ç†

#### æƒé™æŒ‡ä»¤
- âœ… `src/directives/permission.js` - æƒé™æŒ‡ä»¤
  - `v-permission="'order:create'"` - å•ä¸ªæƒé™
  - `v-permission="['order:create', 'order:edit']"` - å¤šä¸ªæƒé™

- âœ… `src/directives/role.js` - è§’è‰²æŒ‡ä»¤
  - `v-role="'admin'"` - å•ä¸ªè§’è‰²
  - `v-role="['admin', 'manager']"` - å¤šä¸ªè§’è‰²

- âœ… `src/directives/index.js` - æŒ‡ä»¤å…¥å£

#### æƒé™å·¥å…·å‡½æ•°
- âœ… `src/utils/permission.js`
  - `hasPermission()` - æ£€æŸ¥æƒé™
  - `hasAnyPermission()` - æ£€æŸ¥ä»»ä¸€æƒé™
  - `hasAllPermissions()` - æ£€æŸ¥æ‰€æœ‰æƒé™
  - `hasRole()` - æ£€æŸ¥è§’è‰²
  - `isAdmin()` - æ£€æŸ¥æ˜¯å¦ç®¡ç†å‘˜

### 3. è·¯ç”±å®ˆå« ğŸ›¡ï¸

#### è·¯ç”±é…ç½®æ›´æ–°
- âœ… `src/router/index.js`
  - è·¯ç”±æƒé™å…ƒä¿¡æ¯é…ç½®
  - å…¨å±€å‰ç½®å®ˆå«
  - ç™»å½•çŠ¶æ€æ£€æŸ¥
  - æƒé™éªŒè¯
  - è§’è‰²éªŒè¯
  - è‡ªåŠ¨è·³è½¬

#### è·¯ç”±å…ƒä¿¡æ¯
```javascript
{
  requiresAuth: true,           // éœ€è¦ç™»å½•
  roles: ['admin', 'manager'],  // å…è®¸çš„è§’è‰²
  permissions: ['order:view']   // éœ€è¦çš„æƒé™
}
```

### 4. Mock æ•°æ®æœåŠ¡ ğŸ­

#### Mock æ–‡ä»¶
- âœ… `src/mock/auth.js`
  - æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“
  - ä¸‰ç§æµ‹è¯•è´¦å·ï¼ˆadmin/manager/userï¼‰
  - æ¨¡æ‹Ÿç™»å½•ã€ç™»å‡º
  - æ¨¡æ‹Ÿæƒé™å’Œèœå•æ•°æ®

#### æµ‹è¯•è´¦å·
| ç”¨æˆ·å | å¯†ç  | è§’è‰² | æƒé™ |
|--------|------|------|------|
| admin | 123456 | ç®¡ç†å‘˜ | æ‰€æœ‰æƒé™ |
| manager | 123456 | ç»ç† | å¤§éƒ¨åˆ†æƒé™ |
| user | 123456 | æ™®é€šç”¨æˆ· | æŸ¥çœ‹æƒé™ |

### 5. ç¯å¢ƒé…ç½® âš™ï¸

#### ç¯å¢ƒæ–‡ä»¶
- âœ… `.env.development` - å¼€å‘ç¯å¢ƒ
- âœ… `.env.production` - ç”Ÿäº§ç¯å¢ƒ
- âœ… `.env.mock` - Mock ç¯å¢ƒ

### 6. é¡µé¢æ›´æ–° ğŸ“„

#### ç™»å½•é¡µæ›´æ–°
- âœ… `src/views/login/index.vue`
  - é›†æˆçœŸå® API
  - Token å­˜å‚¨
  - ç™»å½•æˆåŠŸè·³è½¬
  - é”™è¯¯å¤„ç†

#### Layout æ›´æ–°
- âœ… `src/layout/index.vue`
  - æ ¹æ®æƒé™æ˜¾ç¤ºèœå•
  - æ˜¾ç¤ºçœŸå®ç”¨æˆ·å
  - çœŸå®ç™»å‡ºåŠŸèƒ½
  - ç¡®è®¤å¯¹è¯æ¡†

### 7. å…¨å±€é…ç½® ğŸŒ

#### Main.js æ›´æ–°
- âœ… `src/main.js`
  - æ³¨å†Œæƒé™æŒ‡ä»¤
  - æ³¨å†Œè§’è‰²æŒ‡ä»¤

### 8. æ–‡æ¡£ ğŸ“š

- âœ… `docs/API_AND_PERMISSION.md` - å®Œæ•´æ–‡æ¡£
  - API ä½¿ç”¨è¯´æ˜
  - æƒé™ç³»ç»Ÿä»‹ç»
  - è·¯ç”±å®ˆå«è¯´æ˜
  - ä½¿ç”¨ç¤ºä¾‹
  - Mock æ¨¡å¼è¯´æ˜

## ğŸ“ æ–‡ä»¶ç»“æ„

```
HQ-OMS/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ auth.js            # è®¤è¯ API
â”‚   â”‚   â”œâ”€â”€ order.js           # è®¢å• API
â”‚   â”‚   â”œâ”€â”€ customer.js        # å®¢æˆ· API
â”‚   â”‚   â”œâ”€â”€ product.js         # äº§å“ API
â”‚   â”‚   â””â”€â”€ analysis.js        # æ•°æ®åˆ†æ API
â”‚   â”œâ”€â”€ directives/            # è‡ªå®šä¹‰æŒ‡ä»¤
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ permission.js      # æƒé™æŒ‡ä»¤
â”‚   â”‚   â””â”€â”€ role.js            # è§’è‰²æŒ‡ä»¤
â”‚   â”œâ”€â”€ mock/                  # Mock æ•°æ®
â”‚   â”‚   â””â”€â”€ auth.js
â”‚   â”œâ”€â”€ stores/                # Pinia Store
â”‚   â”‚   â”œâ”€â”€ user.js            # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â””â”€â”€ permission.js      # æƒé™çŠ¶æ€
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.js         # HTTP å°è£…
â”‚   â”‚   â””â”€â”€ permission.js      # æƒé™å·¥å…·
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.js           # è·¯ç”±é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â””â”€â”€ index.vue          # å¸ƒå±€ç»„ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚       â””â”€â”€ index.vue      # ç™»å½•é¡µï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â””â”€â”€ main.js                # å…¥å£æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ API_AND_PERMISSION.md  # APIå’Œæƒé™æ–‡æ¡£
â”œâ”€â”€ .env.development           # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒé…ç½®
â””â”€â”€ .env.mock                  # Mock ç¯å¢ƒé…ç½®
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### æƒé™ç³»ç»Ÿç‰¹ç‚¹
1. âœ… **å¤šçº§æƒé™æ§åˆ¶** - è§’è‰² + æ“ä½œæƒé™
2. âœ… **çµæ´»çš„æƒé™é…ç½®** - è·¯ç”±çº§ + æŒ‰é’®çº§
3. âœ… **ä¸‰ç§ä½¿ç”¨æ–¹å¼** - æŒ‡ä»¤/å·¥å…·å‡½æ•°/Store
4. âœ… **è‡ªåŠ¨èœå•è¿‡æ»¤** - æ ¹æ®æƒé™æ˜¾ç¤ºèœå•
5. âœ… **è·¯ç”±çº§ä¿æŠ¤** - å…¨å±€è·¯ç”±å®ˆå«
6. âœ… **Token ç®¡ç†** - è‡ªåŠ¨åˆ·æ–°å’Œå¤±æ•ˆå¤„ç†

### API ç³»ç»Ÿç‰¹ç‚¹
1. âœ… **ç»Ÿä¸€è¯·æ±‚å°è£…** - Axios æ‹¦æˆªå™¨
2. âœ… **è‡ªåŠ¨ Token æ³¨å…¥** - æ— éœ€æ‰‹åŠ¨æ·»åŠ 
3. âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - å‹å¥½çš„é”™è¯¯æç¤º
4. âœ… **æ¨¡å—åŒ– API** - æŒ‰ä¸šåŠ¡æ¨¡å—åˆ’åˆ†
5. âœ… **Mock æ”¯æŒ** - å¼€å‘æµ‹è¯•æ–¹ä¾¿
6. âœ… **ç¯å¢ƒé…ç½®** - å¤šç¯å¢ƒæ”¯æŒ

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. å¯ç”¨ Mock æ¨¡å¼ï¼ˆå¼€å‘æµ‹è¯•ï¼‰

```bash
# å¤åˆ¶ç¯å¢ƒæ–‡ä»¶
cp .env.mock .env.development

# æˆ–ç›´æ¥ä¿®æ”¹ .env.development
VITE_USE_MOCK=true
```

### 2. ç™»å½•æµ‹è¯•

ä½¿ç”¨ä¸‰ä¸ªæµ‹è¯•è´¦å·ä¹‹ä¸€ï¼š
- `admin` / `123456` - ç®¡ç†å‘˜ï¼ˆæ‰€æœ‰æƒé™ï¼‰
- `manager` / `123456` - ç»ç†ï¼ˆéƒ¨åˆ†æƒé™ï¼‰
- `user` / `123456` - æ™®é€šç”¨æˆ·ï¼ˆæŸ¥çœ‹æƒé™ï¼‰

### 3. æƒé™ä½¿ç”¨ç¤ºä¾‹

#### æ¨¡æ¿ä¸­ä½¿ç”¨
```vue
<template>
  <!-- æƒé™æ§åˆ¶æŒ‰é’® -->
  <el-button v-permission="'order:create'" type="primary">
    æ–°å¢è®¢å•
  </el-button>
  
  <!-- è§’è‰²æ§åˆ¶å†…å®¹ -->
  <div v-role="'admin'">
    ç®¡ç†å‘˜ä¸“å±å†…å®¹
  </div>
</template>
```

#### JavaScript ä¸­ä½¿ç”¨
```javascript
import { hasPermission, hasRole } from '@/utils/permission'

// æ£€æŸ¥æƒé™
if (hasPermission('order:delete')) {
  // æ‰§è¡Œåˆ é™¤æ“ä½œ
}

// æ£€æŸ¥è§’è‰²
if (hasRole('admin')) {
  // ç®¡ç†å‘˜æ“ä½œ
}
```

#### Store ä¸­ä½¿ç”¨
```javascript
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

// æ£€æŸ¥å•ä¸ªæƒé™
const canCreate = userStore.hasPermission('order:create')

// æ£€æŸ¥å¤šä¸ªæƒé™ï¼ˆä»»ä¸€ï¼‰
const canOperate = userStore.hasAnyPermission(['order:edit', 'order:delete'])

// æ£€æŸ¥å¤šä¸ªæƒé™ï¼ˆå…¨éƒ¨ï¼‰
const hasAllPerms = userStore.hasAllPermissions(['order:view', 'order:create'])
```

### 4. API è°ƒç”¨ç¤ºä¾‹

```javascript
import { getOrderList, createOrder } from '@/api/order'

// è·å–æ•°æ®
const fetchData = async () => {
  try {
    const data = await getOrderList({ page: 1, pageSize: 10 })
    console.log(data)
  } catch (error) {
    console.error(error)
  }
}

// åˆ›å»ºæ•°æ®
const handleCreate = async (formData) => {
  try {
    await createOrder(formData)
    ElMessage.success('åˆ›å»ºæˆåŠŸ')
  } catch (error) {
    ElMessage.error(error.message)
  }
}
```

## ğŸ”§ è¿æ¥çœŸå®åç«¯

### 1. ä¿®æ”¹ç¯å¢ƒé…ç½®

```env
# .env.development
VITE_API_BASE_URL=http://localhost:8080/api
VITE_USE_MOCK=false  # å…³é—­ Mock
```

### 2. åç«¯ API è¿”å›æ ¼å¼

```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

### 3. Token æ ¼å¼

åç«¯åº”è¿”å›ï¼š
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userInfo": {
    "id": 1,
    "username": "admin",
    "nickname": "ç®¡ç†å‘˜"
  },
  "roles": ["admin"],
  "permissions": ["order:view", "order:create", ...]
}
```

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

1. **æƒé™ç¼“å­˜** - å‡å°‘æƒé™æŸ¥è¯¢æ¬¡æ•°
2. **åŠ¨æ€è·¯ç”±** - æ ¹æ®æƒé™åŠ¨æ€åŠ è½½è·¯ç”±
3. **æƒé™åˆ·æ–°** - å®æ—¶æ›´æ–°ç”¨æˆ·æƒé™
4. **æ“ä½œæ—¥å¿—** - è®°å½•ç”¨æˆ·æ“ä½œ
5. **å¤šç§Ÿæˆ·æ”¯æŒ** - æ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»
6. **SSO é›†æˆ** - å•ç‚¹ç™»å½•

## ğŸ“Š æƒé™çŸ©é˜µ

| æ¨¡å— | admin | manager | user |
|------|-------|---------|------|
| é¦–é¡µ | âœ… | âœ… | âœ… |
| è®¢å•æŸ¥çœ‹ | âœ… | âœ… | âœ… |
| è®¢å•åˆ›å»º | âœ… | âœ… | âŒ |
| è®¢å•ç¼–è¾‘ | âœ… | âœ… | âŒ |
| è®¢å•åˆ é™¤ | âœ… | âŒ | âŒ |
| å®¢æˆ·ç®¡ç† | âœ… | âœ… | âŒ |
| äº§å“ç®¡ç† | âœ… | âœ… | âŒ |
| æ•°æ®åˆ†æ | âœ… | âœ… | âœ… |

## âœ¨ æ€»ç»“

å·²æˆåŠŸå®Œæˆï¼š
- âœ… **å®Œæ•´çš„ API é›†æˆç³»ç»Ÿ**
- âœ… **å¼ºå¤§çš„æƒé™æ§åˆ¶ç³»ç»Ÿ**
- âœ… **çµæ´»çš„è·¯ç”±å®ˆå«**
- âœ… **Mock æ•°æ®æ”¯æŒ**
- âœ… **å¤šç¯å¢ƒé…ç½®**
- âœ… **è¯¦ç»†çš„æ–‡æ¡£**

ç°åœ¨ç³»ç»Ÿå·²å…·å¤‡ï¼š
- ğŸ” å®Œæ•´çš„è®¤è¯æˆæƒä½“ç³»
- ğŸ›¡ï¸ ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
- ğŸ”Œ æ ‡å‡†åŒ–çš„ API è°ƒç”¨
- ğŸ­ ä¾¿æ·çš„å¼€å‘æµ‹è¯•
- ğŸ“š å®Œå–„çš„ä½¿ç”¨æ–‡æ¡£

---

**ç‰ˆæœ¬**: 1.0.0  
**å®Œæˆæ—¶é—´**: 2025-10-13  
**çŠ¶æ€**: âœ… å·²å®Œæˆ
